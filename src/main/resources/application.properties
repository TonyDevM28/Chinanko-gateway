# === CONFIGURACIÓN DEL SERVIDOR ===
# Render asigna un puerto dinámico en la variable PORT.
# Si no existe (local), usa el 8081.
server.port=${PORT:8081}

spring.application.name=api-gateway

# === EUREKA (DESACTIVADO PARA RENDER) ===
# En Render usaremos rutas directas, así que apagamos Eureka para que no de errores
# buscando un servidor que no existe.
eureka.client.enabled=${EUREKA_ENABLED:false}
eureka.client.register-with-eureka=${EUREKA_ENABLED:false}
eureka.client.fetch-registry=${EUREKA_ENABLED:false}

# === CONFIGURACIÓN DEL GATEWAY ===
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# === RUTA 1: CHINANKO (REST API) ===
spring.cloud.gateway.routes[0].id=chinanko-route
# Aquí usamos una VARIABLE.
# En local podría ser: http://localhost:8080
# En Render será: https://chinanko-api.onrender.com
spring.cloud.gateway.routes[0].uri=${CHINANKO_URL}
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/**, /swagger-ui/**, /v3/api-docs/**, /swagger-ui/index.html

# === RUTA 2: CHINANKO GRAPHQL ===
spring.cloud.gateway.routes[1].id=chinanko-graphql-route
# Otra variable para el servicio de GraphQL
spring.cloud.gateway.routes[1].uri=${GRAPHQL_URL}
spring.cloud.gateway.routes[1].predicates[0]=Path=/graphql/**

# === CORS (MUY IMPORTANTE PARA EL FRONTEND) ===
# Esto evita errores cuando tu Angular intente llamar al Gateway
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origins=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=*