spring.application.name=api-gateway
spring.main.web-application-type=reactive

# === SERVER PORT ===
# Render asigna un puerto dinámico. Local usa 8081.
server.port=${PORT:8081}

# === EUREKA CLIENT ===
eureka.client.enabled=true
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true

# IMPORTANTE: En Render definiremos la variable EUREKA_URI con la URL de tu servidor Eureka
# Ejemplo: https://chinanko-eureka.onrender.com/eureka/
eureka.client.service-url.defaultZone=${EUREKA_URI:http://localhost:8761/eureka/}

# === INSTANCE CONFIG (CRÍTICO EN NUBE) ===
# Le dice a Eureka: "Búscame en esta URL pública", no en localhost.
eureka.instance.hostname=${RENDER_EXTERNAL_HOSTNAME:localhost}
# Opcional pero recomendado en Render para gateways:
eureka.instance.non-secure-port-enabled=false
eureka.instance.secure-port-enabled=true
eureka.instance.home-page-url=https://${eureka.instance.hostname}/
eureka.instance.status-page-url=https://${eureka.instance.hostname}/actuator/info

# === DISCOVERY LOCATOR ===
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# ===============================
# RUTAS (Load Balancer)
# ===============================
# Nota: lb:// funciona porque los otros microservicios también se registrarán en Eureka

# --- AUTH SERVICE (CHINANKO-ROLES) ---
spring.cloud.gateway.routes[0].id=auth-service
spring.cloud.gateway.routes[0].uri=lb://CHINANKO-ROLES
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/v1/users/**, /auth/**

# --- GRAPHQL SERVICE (CHINANKO-GRAPHQL) ---
spring.cloud.gateway.routes[1].id=graphql-service
spring.cloud.gateway.routes[1].uri=lb://CHINANKO-GRAPHQL
spring.cloud.gateway.routes[1].predicates[0]=Path=/graphql/**,/graphiql/**

# --- SWAGGER AUTH ---
spring.cloud.gateway.routes[2].id=auth-swagger-ui
spring.cloud.gateway.routes[2].uri=lb://CHINANKO-ROLES
spring.cloud.gateway.routes[2].predicates[0]=Path=/swagger-ui/**

spring.cloud.gateway.routes[3].id=auth-api-docs
spring.cloud.gateway.routes[3].uri=lb://CHINANKO-ROLES
spring.cloud.gateway.routes[3].predicates[0]=Path=/v3/api-docs/**

# ===============================
# CORS GLOBAL
# ===============================
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-origins=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-methods=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowed-headers=*